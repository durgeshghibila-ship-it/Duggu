<!DOCTYPE html>
<html>
<head>
  <title>Chrome Tab Audio Client</title>
</head>
<body>
<h2>Client - Play Audio</h2>
<audio id="audio" controls autoplay></audio>

<script type="module">
const SIGNALING_SERVER = 'wss://signaling.simplewebrtc.com';
let pc = new RTCPeerConnection();
let audio = document.getElementById('audio');
let ws = new WebSocket(SIGNALING_SERVER);

// Get session ID from URL
let sessionId = new URLSearchParams(window.location.search).get('session');

ws.onopen = () => console.log('Client connected to signaling server');

pc.ontrack = e => audio.srcObject = e.streams[0];

ws.onmessage = async e => {
    let data = JSON.parse(e.data);
    if(data.session === sessionId && data.type === 'offer') {
        await pc.setRemoteDescription(data.sdp);
        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);
        ws.send(JSON.stringify({ type: 'answer', sdp: answer, session: sessionId }));
        console.log('Answer sent to host, audio should start playing.');
    }
};
</script>
</body>
</html>