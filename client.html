<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Audio Client</title>
</head>
<body>
  <h2>Audio Client</h2>
  <audio id="player" autoplay controls></audio>
  <pre id="log"></pre>

  <script>
    const log = document.getElementById("log");
    const audio = document.getElementById("player");
    const pc = new RTCPeerConnection();

    function logMsg(msg) {
      console.log(msg);
      log.textContent += msg + "\n";
    }

    // Receive audio
    pc.ontrack = e => {
      audio.srcObject = e.streams[0];
      logMsg("Audio stream received.");
    };

    async function init() {
      const params = new URLSearchParams(window.location.search);
      const offerBase64 = params.get("offer");
      if (!offerBase64) {
        logMsg("No offer found in URL.");
        return;
      }

      const offer = JSON.parse(atob(offerBase64));
      await pc.setRemoteDescription(offer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
      logMsg("Answer created.");

      // Send answer back to parent window (host)
      window.opener.postMessage({ type: "answer", answer }, "*");
      logMsg("Answer sent to host.");
    }

    init();
  </script>
</body>
</html>
