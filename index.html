<!DOCTYPE html>
<html>
<head>
  <title>Audio Server</title>
</head>
<body>
  <h2>ChromeOS Audio Server</h2>
  <button id="start">Start Streaming</button>
  <textarea id="offer" rows="5" cols="60" readonly></textarea>
  <textarea id="answer" placeholder="Paste client answer here" rows="5" cols="60"></textarea>
  <button id="setAnswer">Set Answer</button>

  <script>
    const pc = new RTCPeerConnection();
    const startBtn = document.getElementById("start");
    const offerBox = document.getElementById("offer");
    const answerBox = document.getElementById("answer");
    const setAnswerBtn = document.getElementById("setAnswer");

    pc.onicecandidate = e => {
      if (!e.candidate) { // ICE gathering finished
        offerBox.value = btoa(JSON.stringify(pc.localDescription)); // encode as short base64
        offerBox.select(); // auto select for easy copy
      }
    };

    startBtn.onclick = async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
        const offer = await pc.createOffer();
        await pc.setLocalDescription(offer);
      } catch (err) {
        alert("Error accessing microphone: " + err.message);
      }
    };

    setAnswerBtn.onclick = async () => {
      try {
        const answer = JSON.parse(atob(answerBox.value));
        await pc.setRemoteDescription(answer);
        alert("âœ… Client connected. Audio streaming started!");
      } catch (err) {
        alert("Invalid answer: " + err.message);
      }
    };
  </script>
</body>
</html>
